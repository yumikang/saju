{
  "dashboard": {
    "title": "PostgreSQL Database Metrics",
    "uid": "postgres-metrics",
    "version": 1,
    "timezone": "browser",
    "panels": [
      {
        "title": "Database Size",
        "type": "graph",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
        "targets": [
          {
            "expr": "pg_database_size_bytes{datname=\"saju_naming\"}",
            "legendFormat": "Database Size"
          }
        ]
      },
      {
        "title": "Active Connections",
        "type": "graph",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
        "targets": [
          {
            "expr": "pg_stat_activity_count{datname=\"saju_naming\"}",
            "legendFormat": "{{state}}"
          }
        ]
      },
      {
        "title": "Transaction Rate",
        "type": "graph",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
        "targets": [
          {
            "expr": "rate(pg_stat_database_xact_commit{datname=\"saju_naming\"}[5m])",
            "legendFormat": "Commits/sec"
          },
          {
            "expr": "rate(pg_stat_database_xact_rollback{datname=\"saju_naming\"}[5m])",
            "legendFormat": "Rollbacks/sec"
          }
        ]
      },
      {
        "title": "Cache Hit Ratio",
        "type": "stat",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
        "targets": [
          {
            "expr": "pg_stat_database_blks_hit{datname=\"saju_naming\"} / (pg_stat_database_blks_hit{datname=\"saju_naming\"} + pg_stat_database_blks_read{datname=\"saju_naming\"}) * 100",
            "legendFormat": "Cache Hit %"
          }
        ]
      },
      {
        "title": "Lock Waits",
        "type": "graph",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
        "targets": [
          {
            "expr": "pg_locks_count{datname=\"saju_naming\", mode=\"ExclusiveLock\"}",
            "legendFormat": "Exclusive Locks"
          },
          {
            "expr": "pg_locks_count{datname=\"saju_naming\", mode=\"AccessShareLock\"}",
            "legendFormat": "Access Share Locks"
          }
        ]
      },
      {
        "title": "Slow Queries",
        "type": "table",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16},
        "targets": [
          {
            "format": "table",
            "rawSql": "SELECT query, calls, mean_exec_time, max_exec_time FROM pg_stat_statements WHERE dbid = (SELECT oid FROM pg_database WHERE datname = 'saju_naming') ORDER BY mean_exec_time DESC LIMIT 10",
            "refId": "A"
          }
        ]
      },
      {
        "title": "Table Sizes",
        "type": "table",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 24},
        "targets": [
          {
            "format": "table",
            "rawSql": "SELECT schemaname, tablename, pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size FROM pg_tables WHERE schemaname = 'public' ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC",
            "refId": "A"
          }
        ]
      },
      {
        "title": "Index Usage",
        "type": "table",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 24},
        "targets": [
          {
            "format": "table",
            "rawSql": "SELECT schemaname, tablename, indexname, idx_scan, idx_tup_read, idx_tup_fetch FROM pg_stat_user_indexes ORDER BY idx_scan DESC LIMIT 10",
            "refId": "A"
          }
        ]
      }
    ]
  }
}